{% extends "base.html" %}
{% load static %}

{% block title %}Upload Content - Briefify{% endblock %}

{% block body_class %}bg-gradient-to-br from-primary-50 via-white to-secondary-50 min-h-full{% endblock %}

{% block header %}
<!-- Breadcrumb Navigation -->
<nav class="bg-white/90 backdrop-blur-md border-b border-neutral-200/50" role="navigation" aria-label="Breadcrumb">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
        <div class="flex items-center justify-between">
            <!-- Breadcrumb -->
            <div class="flex items-center space-x-2 text-sm">
                <a href="/dashboard/" class="text-neutral-600 hover:text-primary-500 transition-colors focus-ring rounded px-2 py-1">
                    <i class="fas fa-home mr-1"></i>Dashboard
                </a>
                <i class="fas fa-chevron-right text-neutral-400 text-xs"></i>
                <span class="text-neutral-900 font-medium">Upload Content</span>
            </div>
            
            <!-- Actions -->
            <div class="flex items-center space-x-3">
                <a href="/dashboard/" class="btn-secondary">
                    <i class="fas fa-arrow-left mr-2"></i>Back to Dashboard
                </a>
            </div>
        </div>
    </div>
</nav>
{% endblock %}
{% block content %}
<!-- Upload Section -->
<section class="py-12">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Header -->
        <div class="text-center mb-12">
            <div class="bg-gradient-to-br from-primary-500 to-secondary-500 w-20 h-20 rounded-2xl flex items-center justify-center mx-auto mb-6">
                <i class="fas fa-cloud-upload-alt text-white text-3xl"></i>
            </div>
            <h1 class="text-3xl lg:text-4xl font-bold text-neutral-900 mb-4">
                Upload Your Content
            </h1>
            <p class="text-xl text-neutral-600 max-w-2xl mx-auto">
                Upload audio, video, or document files to generate AI-powered summaries, 
                transcriptions, and translations.
            </p>
        </div>

        <!-- Upload Form -->
        <div class="card max-w-2xl mx-auto">
            <form enctype="multipart/form-data" method="POST" class="space-y-6" id="uploadForm">
                {% csrf_token %}
                
                <!-- File Upload Area -->
                <div class="space-y-2">
                    <label class="block text-sm font-medium text-neutral-700">
                        Select File
                        <span class="text-red-500">*</span>
                    </label>
                    <div class="relative">
                        <div class="border-2 border-dashed border-neutral-300 hover:border-primary-400 transition-colors rounded-xl p-8 text-center bg-neutral-50/50 hover:bg-primary-50/50">
                            <div id="dropzone" class="cursor-pointer">
                                <div id="uploadPlaceholder">
                                    <i class="fas fa-cloud-upload-alt text-4xl text-neutral-400 mb-4"></i>
                                    <p class="text-lg font-medium text-neutral-700 mb-2">
                                        Drop files here or click to browse
                                    </p>
                                    <p class="text-sm text-neutral-500">
                                        Supports: MP4, MOV, AVI, MP3, WAV, PDF, TXT, DOCX
                                    </p>
                                    <p class="text-xs text-neutral-400 mt-2">
                                        Maximum file size: 100MB
                                    </p>
                                </div>
                                <div id="filePreview" class="hidden">
                                    <div class="flex items-center justify-center space-x-3">
                                        <i class="fas fa-file text-3xl text-primary-500"></i>
                                        <div class="text-left">
                                            <p id="fileName" class="text-lg font-medium text-neutral-900"></p>
                                            <p id="fileSize" class="text-sm text-neutral-500"></p>
                                        </div>
                                        <button type="button" id="removeFile" class="text-red-500 hover:text-red-600 ml-4">
                                            <i class="fas fa-times text-xl"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            {{ form.video_file }}
                        </div>
                    </div>
                </div>

                <!-- Title Field -->
                <div class="space-y-2">
                    <label class="block text-sm font-medium text-neutral-700">
                        Title
                        <span class="text-red-500">*</span>
                    </label>
                    <div class="relative">
                        <i class="fas fa-heading absolute left-3 top-1/2 transform -translate-y-1/2 text-neutral-400"></i>
                        {{ form.title }}
                    </div>
                    <p class="text-xs text-neutral-500">
                        Give your content a descriptive title
                    </p>
                </div>

                <!-- Description Field -->
                <div class="space-y-2">
                    <label class="block text-sm font-medium text-neutral-700">
                        Description
                    </label>
                    <div class="relative">
                        {{ form.description }}
                    </div>
                    <p class="text-xs text-neutral-500">
                        Optional: Add context or notes about your content
                    </p>
                </div>

                <!-- Processing Options -->
                <div class="space-y-4">
                    <h3 class="text-lg font-semibold text-neutral-900">Processing Options</h3>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <label class="flex items-center space-x-3 p-4 border border-neutral-200 rounded-lg hover:bg-primary-50/50 hover:border-primary-300 transition-colors cursor-pointer">
                            <input type="checkbox" name="generate_summary" checked class="w-4 h-4 text-primary-600 focus:ring-primary-500 border-neutral-300 rounded">
                            <div class="flex-1">
                                <div class="flex items-center space-x-2">
                                    <i class="fas fa-compress-alt text-primary-500"></i>
                                    <span class="font-medium text-neutral-900">Generate Summary</span>
                                </div>
                                <p class="text-xs text-neutral-500 mt-1">Create an AI-powered summary</p>
                            </div>
                        </label>
                        
                        <label class="flex items-center space-x-3 p-4 border border-neutral-200 rounded-lg hover:bg-secondary-50/50 hover:border-secondary-300 transition-colors cursor-pointer">
                            <input type="checkbox" name="generate_transcript" checked class="w-4 h-4 text-secondary-600 focus:ring-secondary-500 border-neutral-300 rounded">
                            <div class="flex-1">
                                <div class="flex items-center space-x-2">
                                    <i class="fas fa-microphone text-secondary-500"></i>
                                    <span class="font-medium text-neutral-900">Generate Transcript</span>
                                </div>
                                <p class="text-xs text-neutral-500 mt-1">Extract text from audio/video</p>
                            </div>
                        </label>
                    </div>
                </div>

                <!-- Submit Button -->
                <div class="pt-4">
                    <button type="submit" id="submitBtn" class="btn-primary w-full text-lg py-4 relative overflow-hidden">
                        <span id="submitText" class="flex items-center justify-center">
                            <i class="fas fa-rocket mr-3"></i>
                            Process Content
                        </span>
                        <div id="progressBar" class="absolute bottom-0 left-0 h-1 bg-white/30 transition-all duration-300" style="width: 0%"></div>
                    </button>
                    <p class="text-xs text-neutral-500 text-center mt-3">
                        Processing typically takes 1-3 minutes depending on file size
                    </p>
                </div>
            </form>
        </div>

        <!-- Features Info -->
        <div class="mt-16 grid md:grid-cols-3 gap-8">
            <div class="text-center">
                <div class="bg-primary-100 w-16 h-16 rounded-xl flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-compress-alt text-primary-500 text-2xl"></i>
                </div>
                <h3 class="text-lg font-semibold text-neutral-900 mb-2">Smart Summarization</h3>
                <p class="text-neutral-600">
                    Get concise, actionable summaries that highlight key insights and important details.
                </p>
            </div>
            
            <div class="text-center">
                <div class="bg-secondary-100 w-16 h-16 rounded-xl flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-microphone text-secondary-500 text-2xl"></i>
                </div>
                <h3 class="text-lg font-semibold text-neutral-900 mb-2">Accurate Transcription</h3>
                <p class="text-neutral-600">
                    Convert speech to text with high accuracy across multiple languages and accents.
                </p>
            </div>
            
            <div class="text-center">
                <div class="bg-amber-100 w-16 h-16 rounded-xl flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-language text-amber-500 text-2xl"></i>
                </div>
                <h3 class="text-lg font-semibold text-neutral-900 mb-2">Multi-Language Support</h3>
                <p class="text-neutral-600">
                    Process content in 50+ languages with automatic translation capabilities.
                </p>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const fileInput = document.querySelector('input[type="file"]');
        const dropzone = document.getElementById('dropzone');
        const uploadPlaceholder = document.getElementById('uploadPlaceholder');
        const filePreview = document.getElementById('filePreview');
        const fileName = document.getElementById('fileName');
        const fileSize = document.getElementById('fileSize');
        const removeFile = document.getElementById('removeFile');
        const submitBtn = document.getElementById('submitBtn');
        const submitText = document.getElementById('submitText');
        const progressBar = document.getElementById('progressBar');
        const form = document.getElementById('uploadForm');

        // Style the file input
        fileInput.className = 'absolute inset-0 w-full h-full opacity-0 cursor-pointer';

        // Style form fields
        const titleInput = document.querySelector('input[name="title"]');
        const descriptionInput = document.querySelector('textarea[name="description"]');
        
        if (titleInput) {
            titleInput.className = 'form-input pl-10';
            titleInput.placeholder = 'Enter a descriptive title for your content...';
        }
        
        if (descriptionInput) {
            descriptionInput.className = 'form-textarea';
            descriptionInput.placeholder = 'Add any additional context or notes (optional)...';
            descriptionInput.rows = 3;
        }

        // File upload handling
        function handleFile(file) {
            if (file) {
                // Validate file type
                const allowedTypes = [
                    'video/mp4', 'video/quicktime', 'video/x-msvideo',
                    'audio/mpeg', 'audio/wav', 'audio/x-wav',
                    'application/pdf', 'text/plain',
                    'application/vnd.openxmlformats-officedocument.wordprocessingml.document'
                ];
                
                if (!allowedTypes.some(type => file.type.includes(type.split('/')[0]) || file.type === type)) {
                    alert('Please select a supported file type (video, audio, or document).');
                    return;
                }

                // Validate file size (100MB limit)
                if (file.size > 100 * 1024 * 1024) {
                    alert('File size must be less than 100MB.');
                    return;
                }

                // Show file preview
                fileName.textContent = file.name;
                fileSize.textContent = formatFileSize(file.size);
                uploadPlaceholder.classList.add('hidden');
                filePreview.classList.remove('hidden');

                // Auto-fill title if empty
                if (!titleInput.value) {
                    titleInput.value = file.name.split('.')[0].replace(/[-_]/g, ' ');
                }
            }
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // File input change event
        fileInput.addEventListener('change', function(e) {
            handleFile(e.target.files[0]);
        });

        // Drag and drop events
        dropzone.addEventListener('dragover', function(e) {
            e.preventDefault();
            dropzone.classList.add('border-primary-400', 'bg-primary-50');
        });

        dropzone.addEventListener('dragleave', function(e) {
            e.preventDefault();
            dropzone.classList.remove('border-primary-400', 'bg-primary-50');
        });

        dropzone.addEventListener('drop', function(e) {
            e.preventDefault();
            dropzone.classList.remove('border-primary-400', 'bg-primary-50');
            handleFile(e.dataTransfer.files[0]);
        });

        // Remove file
        removeFile.addEventListener('click', function() {
            fileInput.value = '';
            uploadPlaceholder.classList.remove('hidden');
            filePreview.classList.add('hidden');
        });

        // Form submission
        form.addEventListener('submit', function(e) {
            // Validate required fields
            if (!fileInput.files[0]) {
                e.preventDefault();
                alert('Please select a file to upload.');
                return;
            }

            if (!titleInput.value.trim()) {
                e.preventDefault();
                alert('Please enter a title for your content.');
                titleInput.focus();
                return;
            }

            // Update button state
            submitBtn.disabled = true;
            submitText.innerHTML = '<i class="fas fa-spinner fa-spin mr-3"></i>Processing...';
            
            // Simulate progress (replace with actual progress tracking)
            let progress = 0;
            const interval = setInterval(() => {
                progress += Math.random() * 15;
                if (progress > 90) progress = 90;
                progressBar.style.width = progress + '%';
            }, 200);

            // Clean up on actual form submission
            setTimeout(() => {
                clearInterval(interval);
                progressBar.style.width = '100%';
            }, 3000);
        });

        // Form validation styling
        [titleInput, descriptionInput].forEach(input => {
            if (input) {
                input.addEventListener('invalid', function() {
                    this.classList.add('border-red-500', 'focus:border-red-500', 'focus:ring-red-500');
                });
                
                input.addEventListener('input', function() {
                    if (this.validity.valid) {
                        this.classList.remove('border-red-500', 'focus:border-red-500', 'focus:ring-red-500');
                    }
                });
            }
        });
    });
</script>
{% endblock %}